# Metacore Library

`metacore` - —ç—Ç–æ Go –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –æ—Ä–¥–µ—Ä–∞–º–∏, —Å–¥–µ–ª–∫–∞–º–∏ –∏ –±–∞–ª–∞–Ω—Å–∞–º–∏.

## üöÄ –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏** - —Å–æ–∑–¥–∞–Ω–∏–µ, —á—Ç–µ–Ω–∏–µ, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ, —É–¥–∞–ª–µ–Ω–∏–µ
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞–º–∏** - –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –∂–∏–∑–Ω–∏ —Ç–æ—Ä–≥–æ–≤—ã—Ö –æ—Ä–¥–µ—Ä–æ–≤
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∞–º–∏** - –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∏—Å–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Å–¥–µ–ª–æ–∫
- **–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞–º–∏** - —Ä–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–æ –∞–∫—Ç–∏–≤–∞–º
- **PostgreSQL –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è** - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
- **–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è** - –ª–µ–≥–∫–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –º–æ–∫–∏ –∏ —Ç–µ—Å—Ç—ã

## üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
go get github.com/samar/sup_bot/metacore
```

## üé≠ –î–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π

–î–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞ —Å –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –∑–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π:

```bash
# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Go
go run cmd/main.go

# –ò–ª–∏ —á–µ—Ä–µ–∑ –≥–æ—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã (Windows)
run_demo.bat
run_demo.ps1
```

–î–µ–º–æ-—Å—Ü–µ–Ω–∞—Ä–∏–π —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:
- ‚úÖ –°–æ–∑–¥–∞–Ω–∏–µ –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ (–≤–∫–ª—é—á–∞—è Telegram ID)
- ‚úÖ –†–∞–±–æ—Ç–∞ —Å –æ—Ä–¥–µ—Ä–∞–º–∏
- ‚úÖ –ü–æ–∏—Å–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

–ü–æ–¥—Ä–æ–±–Ω–µ–µ —Å–º. [README_DEMO.md](README_DEMO.md)

## üîß –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –ò–º–ø–æ—Ä—Ç

```go
import "github.com/samar/sup_bot/metacore"
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```go
// –ü–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
cfg := metacore.DefaultConfig()

// –°–æ–∑–¥–∞–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL
db, err := metacore.NewPostgresDB(cfg)
if err != nil {
    log.Fatal(err)
}
defer db.Close()
```

### –†–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏

```go
// –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
user := &metacore.User{
    MexcUID:       "user_123",
    Username:      "trader",
    Email:         "trader@example.com",
    MexcAPIKey:    "api_key",
    MexcSecretKey: "secret_key",
    KYCStatus:     1, // verified
    CanTrade:      true,
    CanWithdraw:   true,
    CanDeposit:    true,
    AccountType:   "spot",
    Permissions:   `["trade", "withdraw", "deposit"]`,
    IsActive:      true,
}

err := db.CreateUser(ctx, user)
if err != nil {
    log.Printf("Error creating user: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ ID
retrievedUser, err := db.GetUserByID(ctx, user.ID)
if err != nil {
    log.Printf("Error getting user: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ MEXC UID
userByUID, err := db.GetUserByMexcUID(ctx, "user_123")
if err != nil {
    log.Printf("Error getting user by UID: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ Telegram ID (–Ω–æ–≤—ã–π –º–µ—Ç–æ–¥)
userByTelegram, err := db.GetUserByTelegramID(ctx, 123456789)
if err != nil {
    log.Printf("Error getting user by Telegram ID: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (–Ω–æ–≤—ã–π –º–µ—Ç–æ–¥)
allUsers, err := db.GetAllUsers(ctx)
if err != nil {
    log.Printf("Error getting all users: %v", err)
}
```

### –†–∞–±–æ—Ç–∞ —Å –æ—Ä–¥–µ—Ä–∞–º–∏

```go
// –°–æ–∑–¥–∞–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞
order := &metacore.Order{
    InternalID:          12345,
    UserID:              user.ID,
    MexcOrderID:         "order_123",
    Symbol:              "BTCUSDT",
    Side:                "BUY",
    Type:                "LIMIT",
    Status:              "NEW",
    Price:               decimal.NewFromFloat(50000.00),
    Quantity:            decimal.NewFromFloat(0.001),
    QuoteOrderQty:       decimal.NewFromFloat(50.00),
    ExecutedQuantity:    decimal.NewFromFloat(0.000),
    CummulativeQuoteQty: decimal.NewFromFloat(0.00),
    ClientOrderID:       "client_123",
    TransactTime:        time.Now(),
}

err := db.CreateOrder(ctx, order)
if err != nil {
    log.Printf("Error creating order: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –æ—Ä–¥–µ—Ä–∞ –ø–æ ID
retrievedOrder, err := db.GetOrderByID(ctx, "order_123")
if err != nil {
    log.Printf("Error getting order: %v", err)
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –æ—Ä–¥–µ—Ä–∞
err = db.UpdateOrderStatus(ctx, "order_123", "FILLED")
if err != nil {
    log.Printf("Error updating order status: %v", err)
}
```

### –†–∞–±–æ—Ç–∞ —Å–æ —Å–¥–µ–ª–∫–∞–º–∏

```go
// –°–æ–∑–¥–∞–Ω–∏–µ —Å–¥–µ–ª–∫–∏
trade := &metacore.Trade{
    InternalID:      12345,
    UserID:          user.ID,
    MexcTradeID:     "trade_123",
    OrderID:         "order_123",
    Symbol:          "BTCUSDT",
    Side:            "BUY",
    Price:           decimal.NewFromFloat(50000.00),
    Quantity:        decimal.NewFromFloat(0.001),
    QuoteQuantity:   decimal.NewFromFloat(50.00),
    Commission:      decimal.NewFromFloat(0.05),
    CommissionAsset: "USDT",
    TransactTime:    time.Now(),
}

err := db.CreateTrade(ctx, trade)
if err != nil {
    log.Printf("Error creating trade: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–¥–µ–ª–∫–∏ –ø–æ ID
retrievedTrade, err := db.GetTradeByID(ctx, "trade_123")
if err != nil {
    log.Printf("Error getting trade: %v", err)
}
```

### –†–∞–±–æ—Ç–∞ —Å –±–∞–ª–∞–Ω—Å–∞–º–∏

```go
// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
balance := &metacore.UserBalance{
    UserID:    user.ID,
    Asset:     "BTC",
    Balance:   decimal.NewFromFloat(0.5),
    Available: decimal.NewFromFloat(0.4),
    Frozen:    decimal.NewFromFloat(0.1),
}

err := db.UpdateBalance(ctx, balance)
if err != nil {
    log.Printf("Error updating balance: %v", err)
}

// –ü–æ–ª—É—á–µ–Ω–∏–µ –±–∞–ª–∞–Ω—Å–∞
retrievedBalance, err := db.GetBalance(ctx, user.ID, "BTC")
if err != nil {
    log.Printf("Error getting balance: %v", err)
}
```

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã

–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:

- `FullStorage` - –æ–±—ä–µ–¥–∏–Ω—è–µ—Ç –≤—Å–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
- `UserStorage` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
- `OrderStorage` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –æ—Ä–¥–µ—Ä–∞–º–∏
- `TradeStorage` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å–æ —Å–¥–µ–ª–∫–∞–º–∏
- `BalanceStorage` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–ª–∞–Ω—Å–∞–º–∏
- `DBInterface` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
metacore/
‚îú‚îÄ‚îÄ metacore.go          # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –±–∏–±–ª–∏–æ—Ç–µ–∫–∏
‚îú‚îÄ‚îÄ domain/              # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ user.go         # –ú–æ–¥–µ–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
‚îÇ   ‚îú‚îÄ‚îÄ order.go        # –ú–æ–¥–µ–ª—å –æ—Ä–¥–µ—Ä–∞
‚îÇ   ‚îú‚îÄ‚îÄ trade.go        # –ú–æ–¥–µ–ª—å —Å–¥–µ–ª–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ user_balance.go # –ú–æ–¥–µ–ª—å –±–∞–ª–∞–Ω—Å–∞
‚îú‚îÄ‚îÄ storage/             # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ö—Ä–∞–Ω–∏–ª–∏—â–∞
‚îÇ   ‚îú‚îÄ‚îÄ full_storage.go # –û—Å–Ω–æ–≤–Ω—ã–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã
‚îÇ   ‚îî‚îÄ‚îÄ mocks/          # –ú–æ–∫–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ postgres/            # PostgreSQL —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ postgresdb.go   # –û—Å–Ω–æ–≤–Ω–æ–π —Ñ–∞–π–ª –ë–î
‚îÇ   ‚îî‚îÄ‚îÄ internal/       # –í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ configs/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ conf.go         # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
‚îî‚îÄ‚îÄ cmd/                 # –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è
    ‚îî‚îÄ‚îÄ main.go         # –î–µ–º–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
```

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–ª–µ–¥—É—é—â–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:

```go
type Config struct {
    DB struct {
        Host     string
        Port     int
        User     string
        Password string
        DBName   string
        SSLMode  string
    }
    Pool struct {
        MaxConns         int
        MinConns         int
        MaxConnLifetime  time.Duration
        MaxConnIdleTime  time.Duration
    }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
go test ./...
```

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–æ–∫—Ä—ã—Ç–∏–µ–º

```bash
go test -v -coverprofile=coverage.out ./...
go tool cover -html=coverage.out -o coverage.html
```

### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–æ–∫–æ–≤

```bash
go generate ./...
```

## üìö –ü—Ä–∏–º–µ—Ä—ã

–ü–æ–ª–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ –≤:

- `cmd/main.go` - –¥–µ–º–æ-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- `examples/` - –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã
- `README_LIBRARY.md` - –ø–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## üîó –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- `github.com/lib/pq` - PostgreSQL –¥—Ä–∞–π–≤–µ—Ä
- `github.com/shopspring/decimal` - –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–µ—Å—è—Ç–∏—á–Ω—ã–º–∏ —á–∏—Å–ª–∞–º–∏
- `github.com/golang/mock` - –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –º–æ–∫–æ–≤ –≤ —Ç–µ—Å—Ç–∞—Ö
- `github.com/stretchr/testify` - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

1. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:**
   ```bash
   go mod download
   ```

2. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ PostgreSQL** –∏ —Å–æ–∑–¥–∞–π—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

3. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –¥–µ–º–æ:**
   ```bash
   go run cmd/main.go
   ```

4. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤ —Å–≤–æ–µ–º –ø—Ä–æ–µ–∫—Ç–µ:**
   ```go
   import "github.com/samar/sup_bot/metacore"
   
   db, err := metacore.NewPostgresDB(metacore.DefaultConfig())
   ```

## ü§ù –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Server

–î–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å `server` –ø—Ä–æ–µ–∫—Ç–æ–º —Å–º–æ—Ç—Ä–∏—Ç–µ `INTEGRATION_GUIDE.md` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞.

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç —è–≤–ª—è–µ—Ç—Å—è —á–∞—Å—Ç—å—é `sup_bot` –∏ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ–¥ —Ç–æ–π –∂–µ –ª–∏—Ü–µ–Ω–∑–∏–µ–π.

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ï—Å–ª–∏ —É –≤–∞—Å –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º—ã:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é
2. –ü–æ—Å–º–æ—Ç—Ä–∏—Ç–µ –ø—Ä–∏–º–µ—Ä—ã –≤ `cmd/main.go`
3. –°–æ–∑–¥–∞–π—Ç–µ issue –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏

---

**Metacore** - –º–æ—â–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –≤ Go! üöÄ
